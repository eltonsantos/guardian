<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="../shared/styles.css" />
  <link rel="stylesheet" href="./options.css" />
  <title>Guardian Settings</title>
</head>
<body>
  <div class="topbar">
    <div class="row" style="gap:10px; align-items:center;">
      <img src="../assets/icon48.png" width="28" height="28" alt="Guardian" style="border-radius:8px;" />
      <div>
        <div class="h1">Guardian</div>
        <div class="small">Settings & protection</div>
      </div>
    </div>
    <div class="row" style="gap:10px;">
      <span class="badge dot on" id="statusBadge">Protection ON</span>
      <label class="switch" title="Enable/Disable Guardian">
        <input type="checkbox" id="enabledToggle" />
        <span class="slider"></span>
      </label>
    </div>
  </div>

  <div class="page">
    <div class="sidebar card">
      <button class="navbtn active" data-tab="rules">Rules</button>
      <button class="navbtn" data-tab="protection">Protection</button>
      <button class="navbtn" data-tab="logs">Logs</button>
      <button class="navbtn" data-tab="about">About</button>
    </div>

    <div class="content">
      <div class="card panel" id="tab-rules">
        <div class="row" style="justify-content:space-between;">
          <div>
            <div class="h1">Blocking Rules</div>
            <p class="p">Add domains and keywords to block navigation within Chrome. Allowlist overrides block rules.</p>
          </div>
        </div>

        <hr />

        <div class="grid2">
          <div>
            <div class="h2">Blocked domains</div>
            <div class="row" style="margin-top:8px;">
              <input class="input" id="addDomain" placeholder="example.com" />
              <button class="btn primary" id="addDomainBtn">Add</button>
            </div>
            <div class="list" id="blockedDomainsList" style="margin-top:10px;"></div>
          </div>

          <div>
            <div class="h2">Blocked keywords (URL contains)</div>
            <div class="row" style="margin-top:8px;">
              <input class="input" id="addKeyword" placeholder="onlyfans (3+ chars)" />
              <button class="btn primary" id="addKeywordBtn">Add</button>
            </div>
            <div class="list" id="blockedKeywordsList" style="margin-top:10px;"></div>
            <p class="small" style="margin-top:10px;">Tip: avoid ultra-broad keywords. Single letters are not allowed.</p>
          </div>

          <div>
            <div class="h2">Allowlist (always allow)</div>
            <div class="row" style="margin-top:8px;">
              <input class="input" id="addAllowDomain" placeholder="trusted.com" />
              <button class="btn" id="addAllowDomainBtn">Add</button>
            </div>
            <div class="list" id="allowDomainsList" style="margin-top:10px;"></div>
          </div>

          <div>
            <div class="h2">Rules management</div>
            <p class="p">Use this button if you want to force rebuild dynamic rules immediately.</p>
            <div class="row" style="margin-top:10px;">
              <button class="btn" id="rebuildBtn">Rebuild rules now</button>
            </div>
            <p class="small" id="rebuildStatus" style="margin-top:10px;"></p>
          </div>
        </div>
      </div>

      <div class="card panel" id="tab-protection" style="display:none;">
        <div class="h1">Protection</div>
        <p class="p">Lock Guardian settings with a password. When lock is enabled, changes require authentication.</p>

        <hr />

        <div class="grid2">
          <div>
            <div class="h2">Lock settings</div>
            <div class="row" style="justify-content:space-between;margin-top:10px;">
              <span class="small">Require password to change settings</span>
              <label class="switch">
                <input type="checkbox" id="lockToggle" />
                <span class="slider"></span>
              </label>
            </div>

            <hr />

            <div class="h2">Set / change password</div>
            <input class="input" id="pw1" type="password" placeholder="New password (min 8 chars)" style="margin-top:8px;" />
            <input class="input" id="pw2" type="password" placeholder="Confirm password" style="margin-top:8px;" />
            <button class="btn primary" id="setPwBtn" style="margin-top:10px;">Save password</button>
            <p class="small" id="pwStatus" style="margin-top:10px;"></p>
          </div>

          <div>
            <div class="h2">Recovery (offline)</div>
            <p class="p">Guardian does not email passwords. Generate recovery codes and a recovery phrase, then store them offline.</p>
            <button class="btn" id="genRecoveryBtn" style="margin-top:10px;">Generate recovery codes + phrase</button>

            <div class="card" style="margin-top:12px;padding:12px;">
              <div class="h2">Recovery codes</div>
              <pre id="recoveryCodes" class="pre"></pre>
              <div class="small">Each code is single-use. Store offline.</div>
            </div>

            <div class="card" style="margin-top:12px;padding:12px;">
              <div class="h2">Recovery phrase</div>
              <pre id="recoveryPhrase" class="pre"></pre>
              <div class="small">Exact phrase required. Keep it private.</div>
            </div>
          </div>

          <div style="grid-column:1/-1;">
            <div class="h2">Unlock / authenticate</div>
            <div class="row" style="gap:10px; margin-top:10px; flex-wrap:wrap;">
              <input class="input" id="authValue" type="password" placeholder="Password or recovery code/phrase" style="max-width:420px;" />
              <button class="btn" id="authBtn">Unlock</button>
              <button class="btn danger" id="lockNowBtn">Lock now</button>
            </div>
            <p class="small" id="authStatus" style="margin-top:10px;"></p>
          </div>
        </div>
      </div>

      <div class="card panel" id="tab-logs" style="display:none;">
        <div class="row" style="justify-content:space-between;">
          <div>
            <div class="h1">Logs</div>
            <p class="p">Optional local record of blocked attempts. Stored locally only.</p>
          </div>
          <button class="btn" id="clearLogsBtn">Clear logs</button>
        </div>
        <hr />
        <div class="list" id="logsList"></div>
      </div>

      <div class="card panel" id="tab-about" style="display:none;">
        <div class="h1">About</div>
        <p class="p">Guardian blocks navigation based on domain and URL keyword rules. It is not a VPN or system-wide filter.</p>
        <hr />
        <div class="small">
          Version: 1.0.0<br/>
          Processing: Local only<br/>
          Privacy: No tracking / no analytics
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="./options.js"></script>
</body>
</html>
