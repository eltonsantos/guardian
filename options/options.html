<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="../shared/styles.css" />
  <link rel="stylesheet" href="./options.css" />
  <title>Guardian Settings</title>
</head>
<body>
  <div class="topbar">
    <div class="row" style="gap:10px; align-items:center;">
      <img src="../assets/icon48.png" width="28" height="28" alt="Guardian" style="border-radius:8px;" />
      <div>
        <div class="h1">Guardian <span class="pro-badge hidden" id="proBadgeTop">PRO</span></div>
        <div class="small">Settings & protection</div>
      </div>
    </div>
    <div class="row" style="gap:10px;">
      <span class="badge dot on" id="statusBadge">Protection ON</span>
      <label class="switch" title="Enable/Disable Guardian">
        <input type="checkbox" id="enabledToggle" />
        <span class="slider"></span>
      </label>
    </div>
  </div>

  <div class="page">
    <div class="sidebar card">
      <button class="navbtn active" data-tab="rules">Rules</button>
      <button class="navbtn" data-tab="protection">Protection</button>
      <button class="navbtn" data-tab="network">Network <span class="nav-pro-tag">PRO</span></button>
      <button class="navbtn" data-tab="logs">Logs</button>
      <button class="navbtn" data-tab="subscription">Subscription</button>
      <button class="navbtn" data-tab="about">About</button>
      <a href="#" class="navbtn" id="openGuideBtn" style="text-decoration:none;color:inherit;text-align:left;">Guia</a>
    </div>

    <div class="content">
      <!-- Onboarding (first run) -->
      <div id="onboardingPanel" class="card" style="display:none; margin-bottom:20px; padding:20px; border:1px solid var(--border);">
        <div class="h1" style="margin-bottom:8px;">Bem-vindo ao Guardian</div>
        <p class="p" style="margin-bottom:16px;">Siga estes passos para começar:</p>
        <ol class="p" style="margin:0 0 16px 20px; line-height:1.6;">
          <li><strong>Definir palavra-passe</strong> — No separador Protection, crie uma palavra-passe para ativar a proteção.</li>
          <li><strong>Ativar proteção</strong> — Use o interruptor no topo para ligar o bloqueio.</li>
          <li><strong>Opcional:</strong> Faça upgrade a Pro (separador Subscription) para proteção em toda a rede (DNS, router, alertas).</li>
        </ol>
        <p class="p small" style="margin-bottom:12px;">Pode consultar o guia completo em qualquer momento clicando em <strong>Guia</strong> na barra lateral.</p>
        <button class="btn primary" id="onboardingDismiss">Continuar</button>
      </div>
      <!-- Rules tab -->
      <div class="card panel" id="tab-rules">
        <div class="row" style="justify-content:space-between;">
          <div>
            <div class="h1">Blocking Rules</div>
            <p class="p">Add domains and keywords to block navigation within Chrome. Allowlist overrides block rules.</p>
          </div>
        </div>

        <hr />

        <div class="grid2">
          <div>
            <div class="h2">Blocked domains</div>
            <div class="row" style="margin-top:8px;">
              <input class="input" id="addDomain" placeholder="example.com" />
              <button class="btn primary" id="addDomainBtn">Add</button>
            </div>
            <div class="list" id="blockedDomainsList" style="margin-top:10px;"></div>
          </div>

          <div>
            <div class="h2">Blocked keywords (URL contains)</div>
            <div class="row" style="margin-top:8px;">
              <input class="input" id="addKeyword" placeholder="onlyfans (3+ chars)" />
              <button class="btn primary" id="addKeywordBtn">Add</button>
            </div>
            <div class="list" id="blockedKeywordsList" style="margin-top:10px;"></div>
            <p class="small" style="margin-top:10px;">Tip: avoid ultra-broad keywords. Single letters are not allowed.</p>
          </div>

          <div>
            <div class="h2">Allowlist (always allow)</div>
            <div class="row" style="margin-top:8px;">
              <input class="input" id="addAllowDomain" placeholder="trusted.com" />
              <button class="btn" id="addAllowDomainBtn">Add</button>
            </div>
            <div class="list" id="allowDomainsList" style="margin-top:10px;"></div>
          </div>

          <div>
            <div class="h2">Rules management</div>
            <p class="p">Use this button if you want to force rebuild dynamic rules immediately.</p>
            <div class="row" style="margin-top:10px;">
              <button class="btn" id="rebuildBtn">Rebuild rules now</button>
            </div>
            <p class="small" id="rebuildStatus" style="margin-top:10px;"></p>
          </div>
        </div>
      </div>

      <!-- Protection tab -->
      <div class="card panel" id="tab-protection" style="display:none;">
        <div class="h1">Protection</div>
        <p class="p">Lock Guardian settings with a password. When lock is enabled, changes require authentication.</p>

        <div id="setupBanner" class="card" style="margin-top:12px;padding:12px;border:1px solid rgba(255,255,255,0.14);" hidden>
          <div class="h2">First-time setup required</div>
          <p class="p" style="margin-top:6px;">To use Guardian, you must create a password first. After you save the password, Guardian will enable protection and apply the recommended default block list.</p>
        </div>

        <hr />

        <div class="grid2">
          <div>
            <div class="h2">Lock settings</div>
            <div class="row" style="justify-content:space-between;margin-top:10px;">
              <span class="small">Require password to change settings</span>
              <label class="switch">
                <input type="checkbox" id="lockToggle" />
                <span class="slider"></span>
              </label>
            </div>

            <hr />

            <div class="h2">Set / change password</div>
            <input class="input" id="pw1" type="password" placeholder="New password (min 8 chars)" style="margin-top:8px;" />
            <input class="input" id="pw2" type="password" placeholder="Confirm password" style="margin-top:8px;" />
            <button class="btn primary" id="setPwBtn" style="margin-top:10px;">Save password</button>
            <p class="small" id="pwStatus" style="margin-top:10px;"></p>
          </div>

          <div>
            <div class="h2">Incognito blocking</div>
            <p class="p">Guardian can block websites in Incognito windows only if Chrome allows this extension in Incognito.</p>
            <div class="row" style="justify-content:space-between;margin-top:10px;">
              <span class="small">Allow in Incognito</span>
              <span class="badge" id="incognitoStatus">&mdash;</span>
            </div>
            <p class="small" id="incognitoHint" style="margin-top:10px;"></p>
            <hr />
            <div class="row" style="justify-content:space-between;margin-top:10px;">
              <span class="small">Block navigation in Incognito windows</span>
              <label class="switch">
                <input type="checkbox" id="blockIncognitoToggle" checked />
                <span class="slider"></span>
              </label>
            </div>
            <p class="small" style="margin-top:10px;">If Incognito is not enabled above, this toggle will not have effect.</p>
          </div>

          <div>
            <div class="h2">Recovery (offline)</div>
            <p class="p">Guardian does not email passwords. Generate recovery codes and a recovery phrase, then store them offline.</p>
            <button class="btn" id="genRecoveryBtn" style="margin-top:10px;">Generate recovery codes + phrase</button>

            <div class="card" style="margin-top:12px;padding:12px;">
              <div class="h2">Recovery codes</div>
              <pre id="recoveryCodes" class="pre"></pre>
              <div class="small">Each code is single-use. Store offline.</div>
            </div>

            <div class="card" style="margin-top:12px;padding:12px;">
              <div class="h2">Recovery phrase</div>
              <pre id="recoveryPhrase" class="pre"></pre>
              <div class="small">Exact phrase required. Keep it private.</div>
            </div>
          </div>

          <div style="grid-column:1/-1;">
            <div class="h2">Unlock / authenticate</div>
            <div class="row" style="gap:10px; margin-top:10px; flex-wrap:wrap;">
              <input class="input" id="authValue" type="password" placeholder="Password or recovery code/phrase" style="max-width:420px;" />
              <button class="btn" id="authBtn">Unlock</button>
              <button class="btn danger" id="lockNowBtn">Lock now</button>
            </div>
            <p class="small" id="authStatus" style="margin-top:10px;"></p>
          </div>
        </div>
      </div>

      <!-- Network tab (Pro) -->
      <div class="card panel" id="tab-network" style="display:none;">
        <div class="row" style="justify-content:space-between;">
          <div>
            <div class="h1">Network Protection <span class="pro-badge-inline">PRO</span></div>
            <p class="p">Configure DNS-level blocking to protect all devices on your network.</p>
          </div>
        </div>

        <!-- Pro gate overlay -->
        <div class="pro-gate hidden" id="networkProGate">
          <div class="pro-gate-content">
            <div class="h2" style="color:var(--warn);">Pro feature</div>
            <p class="p" style="margin-top:6px;">Network protection is available for Guardian Pro subscribers.</p>
            <button class="btn upgrade-btn-inline" id="networkUpgradeBtn" style="margin-top:12px;">Upgrade to Pro &mdash; &euro;2.99/month</button>
          </div>
        </div>

        <div id="networkContent">
          <hr />

          <div class="grid2">
            <div>
              <div class="h2">DNS Status</div>
              <div class="dns-status-box" id="optDnsStatus" style="margin-top:10px;">
                <div class="row" style="gap:8px;">
                  <span class="dns-indicator" id="optDnsDot"></span>
                  <span id="optDnsLabel">Not checked</span>
                </div>
                <button class="btn" id="checkDnsBtn" style="margin-top:10px;">Check DNS now</button>
                <p class="small" id="optDnsTime" style="margin-top:8px;"></p>
              </div>

              <hr />

              <div class="h2">Protection Score</div>
              <div class="score-display" style="margin-top:10px;">
                <div class="score-circle" id="scoreCircle">
                  <span class="score-value" id="scoreValue">--</span>
                </div>
                <div class="score-breakdown" id="scoreBreakdown"></div>
              </div>
            </div>

            <div>
              <div class="h2">Router Setup</div>
              <p class="p" style="margin-top:6px;">Use the wizard to configure your router with a secure DNS provider. This blocks content across all devices on your network.</p>
              <button class="btn primary" id="openWizardBtn" style="margin-top:10px;">Open Router Wizard</button>

              <hr />

              <div class="h2">DNS Check History</div>
              <div class="list" id="dnsHistoryList" style="margin-top:10px;max-height:300px;overflow-y:auto;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Logs tab -->
      <div class="card panel" id="tab-logs" style="display:none;">
        <div class="row" style="justify-content:space-between;">
          <div>
            <div class="h1">Logs</div>
            <p class="p">Optional local record of blocked attempts. Stored locally only.</p>
          </div>
          <button class="btn" id="clearLogsBtn">Clear logs</button>
        </div>
        <hr />
        <div class="list" id="logsList"></div>
      </div>

      <!-- Subscription tab -->
      <div class="card panel" id="tab-subscription" style="display:none;">
        <div id="proOnboardingBanner" class="card" style="display:none; margin-bottom:16px; padding:14px; border:1px solid var(--primary); background: rgba(37, 99, 235, 0.08);">
          <p class="p" style="margin:0 0 10px 0;">Agora tens acesso à proteção de rede. Abre o separador <strong>Network</strong> para configurar o DNS e o assistente do router.</p>
          <div class="row" style="gap:10px;">
            <a href="#" id="proBannerOpenGuide" class="small">Ver guia completo</a>
            <button class="btn small" id="proBannerDismiss" style="padding:4px 10px;">Não mostrar outra vez</button>
          </div>
        </div>
        <div class="h1">Subscription</div>
        <p class="p">Manage your Guardian Pro subscription.</p>
        <hr />

        <div class="grid2">
          <div>
            <div class="h2">Current plan</div>
            <div class="plan-status-box" style="margin-top:10px;">
              <div class="row" style="gap:8px;">
                <span class="plan-indicator" id="planIndicator"></span>
                <span id="planLabel">Free</span>
              </div>
              <p class="small" id="planDetail" style="margin-top:8px;"></p>
            </div>

          </div>

          <div>
            <div class="h2">Upgrade</div>
            <p class="p" style="margin-top:6px;">Get DNS network blocking, router wizard, protection score and more.</p>
            <button class="btn upgrade-btn-inline" id="subUpgradeBtn" style="margin-top:10px;">Upgrade to Pro &mdash; &euro;2.99/month</button>

            <hr />

            <div class="h2">What's included in Pro?</div>
            <ul class="pro-features-list" style="margin-top:10px;">
              <li>DNS network blocking (all devices)</li>
              <li>Router configuration wizard</li>
              <li>Real-time DNS monitoring</li>
              <li>Protection score dashboard</li>
              <li>Network change alerts</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- About tab -->
      <div class="card panel" id="tab-about" style="display:none;">
        <div class="h1">About</div>
        <p class="p">Guardian blocks navigation based on domain and URL keyword rules. Guardian Pro adds network-level DNS blocking for comprehensive protection across all devices.</p>
        <hr />
        <div class="small">
          Version: 2.0.0<br/>
          Processing: Local only<br/>
          Privacy: No tracking / no analytics
        </div>
        <hr />
        <div class="h2">Desenvolvido por</div>
        <p class="p" style="margin-top:8px;">Elton Santos. Se este projeto te ajudou, considere apoiar.</p>
        <div class="row" style="margin-top:12px; gap:16px; flex-wrap:wrap;">
          <a href="https://www.linkedin.com/in/eltonmelosantos" target="_blank" rel="noopener noreferrer" class="small">LinkedIn</a>
          <span class="small">Apoie via PIX: <strong id="pixKeyDisplay">eltin182@gmail.com</strong></span>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="./options.js"></script>
</body>
</html>
